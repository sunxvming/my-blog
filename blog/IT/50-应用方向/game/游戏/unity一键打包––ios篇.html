<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="Content-Style-Type" content="text/css" />
<meta name="generator" content="pandoc" />




<link rel="stylesheet" href="../../../../.././css/style.css" />




<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Saira+Semi+Condensed%3A400%2C700&ver=4.9.18" type="text/css" />

<script src="https://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
<script>
jQuery(document).ready(function(){
    jQuery('pre').each(function(){
        var el = jQuery(this).find('code');
        var code_block = el.html(); 
 
        if (el.length > 0) { 
            jQuery(this).addClass('prettyprint').html(code_block).attr('style', 'max-height:450px');
        } else { 
            jQuery(this).removeClass().addClass('prettyprint'); 
        }
    });
});
</script>

<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js?skin=desert"></script>

</head>


<body>
<div id="wrapper">


<style type="text/css">

#masthead .site-branding {
    margin-bottom: 7px;
}

#masthead .site-branding .site-title {
    font-size: 2.2rem;
    line-height: 1;
    text-transform: uppercase;
    margin: 0;
    margin-bottom: 0.5rem;
}


#masthead .site-description{
	margin:0px;
}




#masthead .site-branding .site-title a {
    display: inline-block;
    position: relative;
    top: -11px;
}

#masthead  a {
    <!-- color: #007bff; -->
    text-decoration: none;
    background-color: transparent;
}



.io-menu-desktop {
    display: block;
    text-align: right;
}
.io-menu-desktop span.io-menu-button-span {
    display: none;
}
.io-menu-desktop ul {
    padding: 0;
    margin: 0;
    list-style: none;
    background: transparent;
    display: block;
}
.io-menu-desktop ul > li {
    margin-right: -4px;
    display: inline-block;
    position: relative;
    height: 30px;
    color: #212529;
    font-size: 12px;
    text-transform: uppercase;
    text-shadow: 0 0 0 rgb(0 0 0 / 0%);
    font-weight: 400;
}
.io-menu-desktop ul > li > a {
    padding: 0;
    line-height: 29px;
    padding-left: 20px;
    padding-right: 20px;
    padding-top: 1px;
    color: #212529;
    font-size: 12px;
    text-transform: uppercase;
    text-shadow: 0 0 0 rgb(0 0 0 / 0%);
    font-weight: 400;
}
.io-menu-desktop a {
    display: block;
    -o-transition: none;
    -moz-transition: none;
    -webkit-transition: none;
    transition: none;
}
.io-menu-desktop > ul > li.current-menu-item > a, .io-menu-desktop > div > ul > li.current-menu-item > a {
    background: rgba(0, 0, 0, 0.01);
}



#colophon {
    margin-top: 70px;
    margin-bottom: 30px;
}
#colophon .site-info {
    text-align: center;
}

</style>


<header id="masthead" class="site-header row">
    <div class="site-branding col-sm-6">
        <span class="site-title" style="font-size: 2.2rem">
            <span>
                <img width="60px" height="60px"
                    src="http://www.sunxvming.com/imgs/QQ图片20191023170517.jpg">
            </span>


            <a href="http://www.sunxvming.com/" rel="home">忧郁的大能猫</a>
        </span>
        <p class="site-description">好奇的探索者，理性的思考者，踏实的行动者。</p>
    </div><!-- .site-branding -->

    <nav id="site-navigation" class="main-navigation col-sm-9">
        <div class="io-menu io-menu-desktop"><span class="io-menu-button io-menu-button-span">≡</span>

            <div class="menu-%e4%b8%bb%e8%8f%9c%e5%8d%95-container">
                <ul id="primary-menu" class="menu">
                    <li id="menu-item-38"
                        class="menu-item menu-item-type-custom menu-item-object-custom current-menu-item current_page_item menu-item-home menu-item-38">
                        <a href="http://www.sunxvming.com">首页</a></li>
                    <li id="menu-item-175"
                        class="menu-item menu-item-type-post_type menu-item-object-page menu-item-175"><a
                            href="http://www.sunxvming.com/">所有文章</a></li>
                    <li id="menu-item-176"
                        class="menu-item menu-item-type-post_type menu-item-object-page menu-item-176"><a
                            href="http://www.sunxvming.com/blog/about-me.html">关于俺</a></li>
                </ul>
            </div>
        </div><!-- .io-menu -->
    </nav><!-- #site-navigation -->
</header>

<div id="header">
<h1 class="title">blog/IT/50-应用方向/game/游戏/unity一键打包––ios篇</h1>
</div> <!--id="header"-->
 <!--if(title)-->

<p>Table of Contents:</p>
<div id="TOC">
<ul>
<li><a href="#一申请开发者账号">一:申请开发者账号</a></li>
<li><a href="#二mac系统版本的选择">二:mac系统版本的选择</a></li>
<li><a href="#三远程连接软件">三:远程连接软件</a></li>
<li><a href="#四unity破解">四:unity破解</a></li>
<li><a href="#五设置文件隐藏">五:设置文件隐藏</a></li>
<li><a href="#六打包出现的问题">六:打包出现的问题</a>
<ul>
<li><a href="#sdk设置">1.SDK设置</a></li>
<li><a href="#bitcode设置">2.bitcode设置</a></li>
<li><a href="#导入库文件">3.导入库文件</a></li>
<li><a href="#其中一个闪退的问题">4.其中一个闪退的问题</a></li>
<li><a href="#打ipa包签名问题">5.打ipa包签名问题</a></li>
<li><a href="#设置打的版本是测试版还是发布版">6.设置打的版本是测试版还是发布版</a></li>
<li><a href="#调试静态库的代码">7.调试静态库的代码</a></li>
</ul></li>
<li><a href="#七ios静态库相关">七:ios静态库相关</a></li>
<li><a href="#八自动打包脚本">八:自动打包脚本</a>
<ul>
<li><a href="#shell脚本">shell脚本</a></li>
<li><a href="#unity中对应的打包方法">unity中对应的打包方法</a></li>
<li><a href="#使用postprocessbuild设定xcode-project">使用PostProcessBuild设定Xcode Project</a></li>
</ul></li>
<li><a href="#九ios包的下载过程">九:ios包的下载过程</a></li>
</ul>
</div>
 <!--if(toc)-->

<blockquote>
<p>本文记录了unity打ios包的相关知识点，以及我的之前的一个mmo游戏项目中的打包脚本，项目所用的unity版本为5.6.6f2</p>
</blockquote>
<h2 id="一申请开发者账号">一:申请开发者账号</h2>
<p>打包的时候需要苹果的开发者账号，时间差不多得两周到一个月左右，得提前准备好申请需要的材料以加快申请的速度。、<br />
公司的开发者账号只有一个，但是开发一个项目是需要多人配合的，总不能所以人都用同一个公司的开发者账号吧。这时需要把开发人员的账号添加到公司的开发者账号的team中。</p>
<h2 id="二mac系统版本的选择">二:mac系统版本的选择</h2>
<p>mac系统的版本要和unity版本一直才能不出问题，这个系统不匹配的问题恰好被我给碰到了。<br />
运行unity时黑屏先查看错误日志，网上查了下是缺少某些文件，按照网上的做法创建文件夹并复制文件即可，后来发现unity中的Assets文件下的东西都无法显示，查了下原来是macos10.13的版本的新的文件格式不支持老的unity编辑器，后来系统换成10.12.6的就好了。换苹果系统一开始是自己网上找教程弄的，但当时下载苹果系统特别慢，反正折腾了一个下午也没弄好，第二天直接58同城上花160块钱找了个专门按系统俩小时就弄好了，哈哈哈哈</p>
<blockquote>
<p>Editor的日志存放目录 ~/Library/Logs/Unity/Editor.log</p>
</blockquote>
<h2 id="三远程连接软件">三:远程连接软件</h2>
<p>Windows远程连mac可以用vnc的软件，百度一下按教程设置一下就可以了</p>
<h2 id="四unity破解">四:unity破解</h2>
<p>下载mac的版本时要注意有普通版本fxx的和补丁版本pxx的，<br />
Mac破解方法:<br />
去网上搜索 http://www.ceeger.com/forum/read.php?tid=23396&amp;uid=24111<br />
首先 - 替换破解补丁Unity文件:<br />
1.找到- 应用程序<br />
2.双击Unity文件夹<br />
3.右键单击Unity文件, 并选择显示包内容<br />
4.双击contents文件夹<br />
5.双击MacOS文件夹<br />
6.右键Unity文件选择拷贝, 并粘贴到桌面作为你的备份<br />
7.返回刚才的文件夹, 里面的Unity文件可以删掉了.<br />
8.从下载的破解压缩包里拖拽Unity破解补丁文件到刚才的文件夹内即可.<br />
然后- 替换破解补丁*.ulf 文件:<br />
1.打开Finder, 在顶部菜单出选择 前往&gt;电脑, 打开后选择磁盘, 双击资源库(不是隐藏的那个资源库,请看清楚)<br />
2.找到双击 Application Support文件夹<br />
3.找到并双击Unity文件夹, 如果没有该文件夹, 请创建名为Unity的文件夹<br />
4.右键文件夹内的 *.ulf文件, 选择拷贝, 并粘贴到桌面作为你的备份<br />
5.返回刚才的文件夹, 里面的*.ulf文件可以删掉了.<br />
6.从下载的破解压缩包里拖拽 *.ulf到刚才的文件夹内即可.</p>
<h2 id="五设置文件隐藏">五:设置文件隐藏</h2>
<p>打包的时候若不想把某个文件夹打进去的话，可以把文件设成隐藏的，用mv命令可以实现<br />
mv testflod .testflod</p>
<h2 id="六打包出现的问题">六:打包出现的问题</h2>
<h3 id="sdk设置">1.SDK设置</h3>
<p>Showing Recent Issues<br />
Error: There is no SDK with the name or path '/Users/mac/Downloads/SimplestPluginExample/XCodePlugin/macosx10.5'<br />
<img src="http://www.sxm-upload.oss-cn-beijing.aliyuncs.com/imgs/d4404ca8-a261-402f-a052-0ee491bda10c.png" /></p>
<h3 id="bitcode设置">2.bitcode设置</h3>
<p>*** does not contain bitcode. You must rebuild it with bitcode enabled (Xcode setting ENABLE_BITCODE), obtain an updated library from the vendor, or disable bitcode for this target. for architecture armv7<br />
<img src="http://www.sxm-upload.oss-cn-beijing.aliyuncs.com/imgs/34a101fd-893f-4172-a26d-8ba7a2372cd4.png" /></p>
<h3 id="导入库文件">3.导入库文件</h3>
<p><img src="http://www.sxm-upload.oss-cn-beijing.aliyuncs.com/imgs/55049109-aeb1-472f-935c-809247a370db.png" /></p>
<h3 id="其中一个闪退的问题">4.其中一个闪退的问题</h3>
<p><img src="http://www.sxm-upload.oss-cn-beijing.aliyuncs.com/imgs/DF30C54B-458E-3B90-49AD-08A5C8E481A7.jpg" /></p>
<h3 id="打ipa包签名问题">5.打ipa包签名问题</h3>
<p>CodeSign 的时候好像会让你输用户的密码，命令行没输就会出错了，下面的命令就是设置下不验证密码</p>
<pre><code>security unlock-keychain -p 123456 ~/Library/Keychains/login.keychain
security set-key-partition-list -S apple-tool:,apple:,codesign: -s -k 123456 ~/Library/Keychains/login.keychain
security set-keychain-settings ~/Library/Keychains/login.keychain</code></pre>
<h3 id="设置打的版本是测试版还是发布版">6.设置打的版本是测试版还是发布版</h3>
<p><img src="http://www.sxm-upload.oss-cn-beijing.aliyuncs.com/imgs/5bf70dc6-6981-47cc-ba83-ff2719c27c96.png" /></p>
<h3 id="调试静态库的代码">7.调试静态库的代码</h3>
<p>luajit的源代码放到xcode工程的plugins/iOS/ 中即可<br />
xcode工程添加预定义编译宏 --&gt; Bulid Setting” --&gt; Preprocessor Macros。<br />
需要删除的文件 ljamalg.c luajit.c 需要添加到文件 lj_vm.S</p>
<h2 id="七ios静态库相关">七:ios静态库相关</h2>
<p>查看静态库 (.a文件）所支持的cup架构: file xx mac下可以使用 otool -hv xx lipo -info xx<br />
1.查看静态库支持的CPU架构<br />
lipo -info libname.a(或者libname.framework/libname)<br />
2.合并静态库<br />
lipo -create 静态库存放路径1 静态库存放路径2 ... -output 整合后存放的路径<br />
lipo -create libname-armv7.a libname-armv7s.a libname-i386.a -output libname.a<br />
framework 合并(例util.framework)<br />
lipo -create arm7/util.framework/util i386/util.framework/util -output util.framework<br />
3.静态库拆分<br />
lipo 静态库源文件路径 -thin CPU架构名称 -output 拆分后文件存放路径 架构名为armv7/armv7s/arm64等，与lipo -info 输出的架构名一致<br />
lipo libname.a -thin armv7 -output libname-armv7.a<br />
1.依赖的库查询:otool -L xxx<br />
2.查汇编代码:otool -tV ex</p>
<h2 id="八自动打包脚本">八:自动打包脚本</h2>
<h3 id="shell脚本">shell脚本</h3>
<pre><code>#!/bin/sh
SHDIR=&quot;$( cd &quot;$( dirname &quot;${BASH_SOURCE[0]}&quot; )&quot; &amp;&amp; pwd )&quot;
UNITY_PATH=/Applications/Unity/Unity.app/Contents/MacOS/Unity
PROJECT_PATH=${SHDIR}/../client/
UNITY_LOG_PATH=${SHDIR}/build-ios-exe-output/unity_log.txt
XCODE_PATH=${SHDIR}/build-ios-exe-output/xcode
UNITY_METHOD_NAME=RiseTool.BuildIOSXcode
rm -rf $XCODE_PATH
$UNITY_PATH -quit -batchmode -logFile $UNITY_LOG_PATH -projectPath $PROJECT_PATH -executeMethod $UNITY_METHOD_NAME -outputPath $XCODE_PATH
echo &#39;step1:export xcode success!!!&#39;
#------------------------
scheme_name=&quot;Unity-iPhone&quot;
export_plist=${SHDIR}/build-ios-exe-output/ExportOptions.plist
project_name=&quot;Unity-iPhone.xcodeproj&quot;
ipa_dir=${SHDIR}/build-ios-exe-output/ipa
configuration=&quot;Debug&quot;
#configuration=&quot;Release&quot;
archivePath=${XCODE_PATH}/build/${scheme_name}.xcarchive
rm -rf $ipa_dir
cd $XCODE_PATH
xcodebuild clean
xcodebuild archive -project &quot;${project_name}&quot; -scheme &quot;${scheme_name}&quot; -configuration &quot;$configuration&quot; -archivePath &quot;${archivePath}&quot;
xcodebuild -exportArchive -archivePath &quot;${archivePath}&quot; -exportPath &quot;${ipa_dir}&quot; -exportOptionsPlist &quot;${export_plist}&quot;
echo &#39;step2:build ipa success!!!&#39;
open ${ipa_dir}</code></pre>
<h3 id="unity中对应的打包方法">unity中对应的打包方法</h3>
<pre><code>[MenuItem(&quot;Tools/打版/ios生成xcode&quot;)]
public static void BuildIOSXcode()
{
 string outputPath = EditorConfig.buildPath + &quot;build-ios-exe-output/xcode&quot;;
 string[] ss = System.Environment.GetCommandLineArgs();
 for (int i = 0; i &lt; ss.Length; i++)
 {
  if (ss[i] == &quot;-outputPath&quot;)
  {
   outputPath = ss[i + 1];
  }
 }
 outputPath = outputPath.Replace(&#39;\\&#39;, &#39;/&#39;);
 List&lt;string&gt; levels = new List&lt;string&gt;();
 foreach (EditorBuildSettingsScene scene in EditorBuildSettings.scenes)
 {
  if (!scene.enabled) continue;
  levels.Add(scene.path);
 }
 EditorUserBuildSettings.SwitchActiveBuildTarget(BuildTargetGroup.iOS, BuildTarget.iOS);
 string res = BuildPipeline.BuildPlayer(levels.ToArray(), outputPath, BuildTarget.iOS, BuildOptions.None);
 if (res.Length &gt; 0)
  throw new Exception(&quot;BuildPlayer failure: &quot; + res);
}</code></pre>
<h3 id="使用postprocessbuild设定xcode-project">使用PostProcessBuild设定Xcode Project</h3>
<p>unity提供一套api去修改xcode项目工程配置以及修改plist文件内容(当unity build结束后, 会自动回调OnPostProcessBuild),可以在这个方法中添加配置xcode的方法</p>
<pre><code>public class IosBuildScript : UnityEngine.MonoBehaviour
{
    [UnityEditor.Callbacks.PostProcessBuild(999)]
    public static void OnPostprocessBuild(UnityEditor.BuildTarget BuildTarget, string path)
    {
#if UNITY_IPHONE || UNITY_IOS
        if (BuildTarget == UnityEditor.BuildTarget.iOS)
        {
            UnityEngine.Debug.Log(&quot;OnPostprocessBuild : path1&quot; + path);
            // /Users/mac/project/trunk/risexcode/build/build-ios-exe-output/xcode
            //添加系统framework
            string projPath = UnityEditor.iOS.Xcode.PBXProject.GetPBXProjectPath(path);
            UnityEditor.iOS.Xcode.PBXProject proj = new UnityEditor.iOS.Xcode.PBXProject();
            UnityEngine.Debug.Log(&quot;OnPostprocessBuild : path2&quot; + projPath);
            // /Users/mac/project/trunk/risexcode/build/build-ios-exe-output/xcode/Unity-iPhone.xcodeproj/project.pbxproj
            proj.ReadFromString(System.IO.File.ReadAllText(projPath));
            string target = proj.TargetGuidByName(UnityEditor.iOS.Xcode.PBXProject.GetUnityTargetName());
            //添加库
            proj.AddFrameworkToProject(target, &quot;CoreTelephony.framework&quot;, false);
            proj.AddFrameworkToProject(target, &quot;libstdc++.6.0.9.tbd&quot;, false);
            proj.AddFrameworkToProject(target, &quot;Security.framework&quot;, false);
            proj.AddFrameworkToProject(target, &quot;CoreAudio.framework&quot;, false);
            //证书，签名，相关
            proj.SetBuildProperty(target, &quot;DEVELOPMENT_TEAM&quot;, &quot;ZGFZTGAMFM&quot;);
            proj.SetBuildProperty(target, &quot;ENABLE_BITCODE&quot;, &quot;NO&quot;);
            proj.SetBuildProperty(target, &quot;VALID_ARCHS&quot;, &quot;arm64&quot;);
            System.IO.File.WriteAllText(projPath, proj.WriteToString());
            //Handle info.plist
            string plistPath = path + &quot;/Info.plist&quot;;
            UnityEditor.iOS.Xcode.PlistDocument plist = new UnityEditor.iOS.Xcode.PlistDocument();
            plist.ReadFromString(System.IO.File.ReadAllText(plistPath));
            UnityEditor.iOS.Xcode.PlistElementDict rootDict = plist.root;
            rootDict.SetString(&quot;NSMicrophoneUsageDescription&quot;, &quot;测试腾讯云游戏语音录音&quot;);
            System.IO.File.WriteAllText(plistPath, plist.WriteToString());
        }
#endif
    }
}</code></pre>
<h2 id="九ios包的下载过程">九:ios包的下载过程</h2>
<p>如何实现在网页中点击链接即可下载ios的ipa包呢？步骤如下:<br />
网页中的链接协议如下:<br />
itms-services:///?action=download-manifest&amp;url=https://res1-mfwz.top1game.com/sjzs/mfwziOS.plist<br />
就是通过这个链接找到plist文件(plist需要放在https的服务器上)，plist文件中再说明下载的ipa包的具体位置，plist文件格式如下:</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;
&lt;plist version=&quot;1.0&quot;&gt;
&lt;dict&gt;
    &lt;key&gt;items&lt;/key&gt;
    &lt;array&gt;
        &lt;dict&gt;
            &lt;key&gt;assets&lt;/key&gt;
            &lt;array&gt;
                &lt;dict&gt;
                    &lt;key&gt;kind&lt;/key&gt;
                    &lt;string&gt;software-package&lt;/string&gt;
                    &lt;key&gt;url&lt;/key&gt;
      &lt;string&gt;http://res1-mfwz.top1game.com/sjzs/mfwz.ipa&lt;/string&gt;
                &lt;/dict&gt;
                &lt;dict&gt;
                    &lt;key&gt;kind&lt;/key&gt;
                    &lt;string&gt;full-size-image&lt;/string&gt;
                    &lt;key&gt;needs-shine&lt;/key&gt;
                    &lt;true/&gt;
                    &lt;key&gt;url&lt;/key&gt;
                    &lt;string&gt;http://res1-mfwz.top1game.com/sjzs/120.png&lt;/string&gt;
                &lt;/dict&gt;
                &lt;dict&gt;
                    &lt;key&gt;kind&lt;/key&gt;
                    &lt;string&gt;display-image&lt;/string&gt;
                    &lt;key&gt;needs-shine&lt;/key&gt;
                    &lt;true/&gt;
                    &lt;key&gt;url&lt;/key&gt;
                    &lt;string&gt;http://res1-mfwz.top1game.com/sjzs/72.png&lt;/string&gt;
                &lt;/dict&gt;
            &lt;/array&gt;
            &lt;key&gt;metadata&lt;/key&gt;
            &lt;dict&gt;
                &lt;key&gt;bundle-identifier&lt;/key&gt;
  &lt;string&gt;com.fancyguo.pxjy&lt;/string&gt;
                &lt;key&gt;bundle-version&lt;/key&gt;
                &lt;string&gt;1.0&lt;/string&gt;
                &lt;key&gt;kind&lt;/key&gt;
                &lt;string&gt;software&lt;/string&gt;
                &lt;key&gt;subtitle&lt;/key&gt;
                &lt;string&gt;魔法王座助手&lt;/string&gt;
                &lt;key&gt;title&lt;/key&gt;
                &lt;string&gt;魔法王座助手&lt;/string&gt;
            &lt;/dict&gt;
        &lt;/dict&gt;
    &lt;/array&gt;
&lt;/dict&gt;
&lt;/plist&gt;</code></pre>

<footer id="colophon" >
		<div class="site-info col">
			Powered by <a href="https://github.com/sunxvming/my-blog">my-blog</a>
			<span class="sep"> | </span>
				<span><a target="_blank" href="http://beian.miit.gov.cn">【京ICP备19018538号】</a></span>
			<span><a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=11010502037753">【京公网安备 11010502037753号】</a></span>
		</div><!-- .site-info col -->
        <div class="site-info col"> This page is hosted at <a target="_blank" href="https://github.com/sunxvming">Github</a>.To see the source code you can visit the <a target="_blank" href="https://github.com/sunxvming/my-blog">repo</a> and I'd be glad if you like and star it.</div>
</footer>
</div> <!--wrapper-->
</body>
</html>
