<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="Content-Style-Type" content="text/css" />
<meta name="generator" content="pandoc" />




<link rel="stylesheet" href="../../.././css/style.css" />




<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Saira+Semi+Condensed%3A400%2C700&ver=4.9.18" type="text/css" />

<script src="https://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
<script>
jQuery(document).ready(function(){
    jQuery('pre').each(function(){
        var el = jQuery(this).find('code');
        var code_block = el.html(); 
 
        if (el.length > 0) { 
            jQuery(this).addClass('prettyprint').html(code_block).attr('style', 'max-height:450px');
        } else { 
            jQuery(this).removeClass().addClass('prettyprint'); 
        }
    });
});
</script>

<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js?skin=desert"></script>

</head>


<body>
<div id="wrapper">


<style type="text/css">

#masthead .site-branding {
    margin-bottom: 7px;
}

#masthead .site-branding .site-title {
    font-size: 2.2rem;
    line-height: 1;
    text-transform: uppercase;
    margin: 0;
    margin-bottom: 0.5rem;
}


#masthead .site-description{
	margin:0px;
}




#masthead .site-branding .site-title a {
    display: inline-block;
    position: relative;
    top: -11px;
}

#masthead  a {
    <!-- color: #007bff; -->
    text-decoration: none;
    background-color: transparent;
}



.io-menu-desktop {
    display: block;
    text-align: right;
}
.io-menu-desktop span.io-menu-button-span {
    display: none;
}
.io-menu-desktop ul {
    padding: 0;
    margin: 0;
    list-style: none;
    background: transparent;
    display: block;
}
.io-menu-desktop ul > li {
    margin-right: -4px;
    display: inline-block;
    position: relative;
    height: 30px;
    color: #212529;
    font-size: 12px;
    text-transform: uppercase;
    text-shadow: 0 0 0 rgb(0 0 0 / 0%);
    font-weight: 400;
}
.io-menu-desktop ul > li > a {
    padding: 0;
    line-height: 29px;
    padding-left: 20px;
    padding-right: 20px;
    padding-top: 1px;
    color: #212529;
    font-size: 12px;
    text-transform: uppercase;
    text-shadow: 0 0 0 rgb(0 0 0 / 0%);
    font-weight: 400;
}
.io-menu-desktop a {
    display: block;
    -o-transition: none;
    -moz-transition: none;
    -webkit-transition: none;
    transition: none;
}
.io-menu-desktop > ul > li.current-menu-item > a, .io-menu-desktop > div > ul > li.current-menu-item > a {
    background: rgba(0, 0, 0, 0.01);
}



#colophon {
    margin-top: 70px;
    margin-bottom: 30px;
}
#colophon .site-info {
    text-align: center;
}

</style>


<header id="masthead" class="site-header row">
    <div class="site-branding col-sm-6">
        <span class="site-title" style="font-size: 2.2rem">
            <span>
                <img width="60px" height="60px"
                    src="http://www.sunxvming.com/imgs/QQ图片20191023170517.jpg">
            </span>


            <a href="http://www.sunxvming.com/" rel="home">忧郁的大能猫</a>
        </span>
        <p class="site-description">好奇的探索者，理性的思考者，踏实的行动者。</p>
    </div><!-- .site-branding -->

    <nav id="site-navigation" class="main-navigation col-sm-9">
        <div class="io-menu io-menu-desktop"><span class="io-menu-button io-menu-button-span">≡</span>

            <div class="menu-%e4%b8%bb%e8%8f%9c%e5%8d%95-container">
                <ul id="primary-menu" class="menu">
                    <li id="menu-item-38"
                        class="menu-item menu-item-type-custom menu-item-object-custom current-menu-item current_page_item menu-item-home menu-item-38">
                        <a href="http://www.sunxvming.com">首页</a></li>
                    <li id="menu-item-175"
                        class="menu-item menu-item-type-post_type menu-item-object-page menu-item-175"><a
                            href="http://www.sunxvming.com/all-articles">所有文章</a></li>
                    <li id="menu-item-176"
                        class="menu-item menu-item-type-post_type menu-item-object-page menu-item-176"><a
                            href="http://www.sunxvming.com/about">关于俺</a></li>
                </ul>
            </div>
        </div><!-- .io-menu -->
    </nav><!-- #site-navigation -->
</header>

<div id="header">
<h1 class="title">blog/IT/CS基础/编译原理之美</h1>
</div> <!--id="header"-->
 <!--if(title)-->

<p>Table of Contents:</p>
<div id="TOC">
<ul>
<li><a href="#开篇词-为什么你要学习编译原理"> 开篇词 | 为什么你要学习编译原理？</a></li>
<li><a href="#理解代码编译器的前端技术"> 01 | 理解代码：编译器的前端技术</a>
<ul>
<li><a href="#词法分析"> 词法分析</a></li>
<li><a href="#语法分析"> 语法分析</a></li>
<li><a href="#语义分析"> 语义分析</a></li>
<li><a href="#课程小结"> 课程小结</a></li>
</ul></li>
<li><a href="#正则文法和有限自动机纯手工打造词法分析器"> 02 | 正则文法和有限自动机：纯手工打造词法分析器</a></li>
<li><a href="#语法分析一纯手工打造公式计算器"> 03 | 语法分析（一）：纯手工打造公式计算器</a></li>
<li><a href="#高效运行编译器的后端技术"> 20 | 高效运行：编译器的后端技术</a></li>
<li><a href="#运行时机制突破现象看本质透过语法看运行时"> 21 | 运行时机制：突破现象看本质，透过语法看运行时</a></li>
<li><a href="#生成汇编代码一汇编语言其实不难学"> 22 | 生成汇编代码（一）：汇编语言其实不难学</a></li>
<li><a href="#生成汇编代码二把脚本编译成可执行文件"> 23 | 生成汇编代码（二）：把脚本编译成可执行文件</a></li>
<li><a href="#中间代码兼容不同的语言和硬件"> 24 | 中间代码：兼容不同的语言和硬件</a></li>
<li><a href="#后端技术的重用llvm不仅仅让你高效"> 25 | 后端技术的重用：LLVM不仅仅让你高效</a></li>
<li><a href="#生成ir实现静态编译的语言"> 26 | 生成IR：实现静态编译的语言</a></li>
<li><a href="#代码优化为什么你的代码比他的更高效"> 27 | 代码优化：为什么你的代码比他的更高效？</a>
<ul>
<li><a href="#了解代码优化的目标对象范围和策略"> 了解代码优化的目标、对象、范围和策略</a>
<ul>
<li><a href="#代码优化的目标"> 代码优化的目标： </a></li>
<li><a href="#代码优化的对象"> 代码优化的对象：</a></li>
<li><a href="#代码优化的范围"> 代码优化的范围</a></li>
<li><a href="#代码优化的策略"> 代码优化的策略</a></li>
</ul></li>
<li><a href="#一些优化的场景"> 一些优化的场景</a></li>
</ul></li>
<li><a href="#数据流分析你写的程序它更懂"> 28 | 数据流分析：你写的程序，它更懂</a></li>
<li><a href="#目标代码的生成和优化一如何适应各种硬件架构"> 29 | 目标代码的生成和优化（一）：如何适应各种硬件架构？</a></li>
</ul>
</div>
 <!--if(toc)-->

<h2 id="开篇词-为什么你要学习编译原理"> 开篇词 | 为什么你要学习编译原理？</h2>
<p>编译原理不是只能用于炫耀的屠龙技。 别的不说，作为程序员，在实际工作中你经常会碰到需要编译技术的场景。</p>
<h2 id="理解代码编译器的前端技术"> 01 | 理解代码：编译器的前端技术</h2>
<p>这里的“前端”指的是编译器<strong>对程序代码的分析和理解过程</strong>。<br />
它通常只跟语言的语法有关，跟目标机器无关。而与之对应的“后端”则是生成目标代码的过程，跟目标机器有关。<br />
<img src="/imgs/50d447ee-b192-4f7d-b236-fbf070db87e1.jpg" /></p>
<h3 id="词法分析"> 词法分析</h3>
<p>文章是由一个个的单词组成的。程序处理也一样，只不过这里不叫单词，而是叫做“词法记号”，英文叫 Token。词法分析是识别一个个的token，即分词程序。</p>
<p>分词是按照一定规则来写的。</p>
<p>这些规则可以通过手写程序来实现。事实上，很多编译器的词法分析器都是手写实现的，例如 GNU 的 C 语言编译器。<br />
如果嫌手写麻烦，也可以偷点儿懒，用词法分析器的生 成工具来生成，比如 Lex（或其 GNU 版本，Flex）。这些工具是按照正则表达式来分词的。</p>
<h3 id="语法分析"> 语法分析</h3>
<p>语法分析就是在词法分析的基础上识别出程序的<strong>语法结构</strong>。这个结构是一个<strong>树状结构</strong>，是计算机容易理解和执行的。</p>
<p>程序有定义良好的语法结构，它的语法分析过程，就是构造这么一棵树。一个程序就是一棵树，这棵树叫做<strong>抽象语法树</strong>（Abstract Syntax Tree，AST）。树的每个节点（子树）是一个<strong>语法单元</strong>，这个单元的构成规则就叫“语法”。每个节点还可以有下级节点。</p>
<h3 id="语义分析"> 语义分析</h3>
<p>语义分析就是要让计算机理解我们的真实意图，把一些模棱两可的地方消除掉。<br />
语义分析工作的某些成果，<strong>会作为属性标注在抽象语法树上</strong>，比如在 age 这个标识符节点和 45 这个字面量节点上，都会标识它的数据类型是 int 型的。<br />
在这个树上还可以标记很多属性，有些属性是在之前的两个阶段就被标注上了，比如所处的源代码行号，这一行的第几个字符。这样，在编译程序报错的时候，就可以比较清楚地了解出错的位置。<br />
做了这些属性标注以后，编译器在后面就<strong>可以依据这些信息</strong>生成目标代码了，我们在编译技术的后端部分会去讲。<br />
语法阶段是上下文无关的，语义阶段则<strong>专门处理上下文</strong>。</p>
<h3 id="课程小结"> 课程小结</h3>
<p><em> 词法分析是把程序分割成一个个 Token 的过程，可以通过构造有限自动机来实现。<br />
</em> 语法分析是把程序的结构识别出来，并形成一棵便于由计算机处理的抽象语法树。可以用<strong>递归下降</strong>的算法来实现。<br />
* 语义分析是消除语义模糊，<strong>生成一些属性信息</strong>，让计算机能够依据这些信息生成目标代码。</p>
<h2 id="正则文法和有限自动机纯手工打造词法分析器"> 02 | 正则文法和有限自动机：纯手工打造词法分析器</h2>
<p>要实现一个词法分析器，首先需要写出每个词法的正则表达式，并画出有限自动机，<br />
之后，只要用代码表示这种状态迁移过 程就可以了。</p>
<h2 id="语法分析一纯手工打造公式计算器"> 03 | 语法分析（一）：纯手工打造公式计算器</h2>
<p>初步了解上下文无关文法，知道它能表达主流的计算机语言，以及与正则文法的区别。<br />
理解递归下降算法中的“下降”和“递归”两个特点。它跟文法规则基本上是同构的，通<br />
过文法一定能写出算法。<br />
通过遍历 AST 对表达式求值，加深对计算机程序执行机制的理解</p>
<h2 id="高效运行编译器的后端技术"> 20 | 高效运行：编译器的后端技术</h2>
<h2 id="运行时机制突破现象看本质透过语法看运行时"> 21 | 运行时机制：突破现象看本质，透过语法看运行时</h2>
<h2 id="生成汇编代码一汇编语言其实不难学"> 22 | 生成汇编代码（一）：汇编语言其实不难学</h2>
<h2 id="生成汇编代码二把脚本编译成可执行文件"> 23 | 生成汇编代码（二）：把脚本编译成可执行文件</h2>
<h2 id="中间代码兼容不同的语言和硬件"> 24 | 中间代码：兼容不同的语言和硬件</h2>
<h2 id="后端技术的重用llvm不仅仅让你高效"> 25 | 后端技术的重用：LLVM不仅仅让你高效</h2>
<h2 id="生成ir实现静态编译的语言"> 26 | 生成IR：实现静态编译的语言</h2>
<h2 id="代码优化为什么你的代码比他的更高效"> 27 | 代码优化：为什么你的代码比他的更高效？</h2>
<p>问题：<br />
<em> 代码优化的目标是什么？除了性能上的优化，还有什么优化？<br />
</em> 代码优化可以在多大的范围内执行？是在一个函数内，还是可以针对整个应用程序？<br />
* 常见的代码优化场景有哪些？</p>
<h3 id="了解代码优化的目标对象范围和策略"> 了解代码优化的目标、对象、范围和策略</h3>
<h4 id="代码优化的目标"> 代码优化的目标： </h4>
<p>CPU利用率（主要）、代码大小、内存占用大小、磁盘访问次数、网络通讯次数等等</p>
<h4 id="代码优化的对象"> 代码优化的对象：</h4>
<p>大多数的代码优化都是在 IR 上做的，而不是在前一阶段的 AST 和后一阶段汇编代码上进行的<br />
在 AST上抽象层次太高，含有的硬件架构信息太少。在汇编代码上进行优化会让算法跟机器相关，当换一个目标机器的时候，还要重新编写优化代码。</p>
<h4 id="代码优化的范围"> 代码优化的范围</h4>
<p>从优化的范围看，分为:<br />
本地优化<br />
针对基本块进行优化<br />
全局优化<br />
如果通过分析 CFG，我们发现 t 在其他地方没有被使用，就可以把第二行删掉。这种针对一个函数、基于 CFG 的优化，叫做全局优化（Global Optimization）<br />
过程间优化<br />
它能跨越函数的边界，对多个函数之间的关系进行优化，而不是仅针对一个函数做优化。</p>
<h4 id="代码优化的策略"> 代码优化的策略</h4>
<p>你不需要每次都把代码优化做彻底，因为做代码优化本身也需要消耗计算机的资源。<br />
所以，你需要权衡代码优化带来的好处和优化本身的开支这两个方面，然后确定做多少优化。</p>
<h3 id="一些优化的场景"> 一些优化的场景</h3>
<p>代数优化（Algebraic Optimazation）<br />
常数折叠（Constant Folding）<br />
删除不可达的基本块<br />
删除公共子表达式（Common Subexpression Elimination）<br />
拷贝传播（Copy Propagation）和常数传播（Constant Propagation）<br />
死代码删除（Ded code elimintation）<br />
多次优化</p>
<p>一个优化可能导致另一个优化，比如，拷贝传播导致 y 不再被使用，我<br />
们又可以进行死代码删除的优化。所以，一般进行多次优化、多次扫描。</p>
<h2 id="数据流分析你写的程序它更懂"> 28 | 数据流分析：你写的程序，它更懂</h2>
<p>全局优化比本地优化能做的工作更多，分析算法也更复杂，因为 CFG 中可能存在多<br />
条执行路径。不过，我们可以在上一节课提到的本地优化的算法思路上，解决掉多路径情况<br />
下，V 值的计算问题。而这种基于 CFG 做优化分析的方法框架，就叫做数据流分析</p>
<h2 id="目标代码的生成和优化一如何适应各种硬件架构"> 29 | 目标代码的生成和优化（一）：如何适应各种硬件架构？</h2>

<footer id="colophon" >
		<div class="site-info col">
			Powered by <a href="https://github.com/sunxvming/my-blog">my-blog</a>
			<span class="sep"> | </span>
				<span><a target="_blank" href="http://beian.miit.gov.cn">【京ICP备19018538号】</a></span>
			<span><a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=11010502037753">【京公网安备 11010502037753号】</a></span>
		</div><!-- .site-info col -->
        <div class="site-info col"> This page is hosted at <a target="_blank" href="https://github.com/sunxvming">Github</a>.To see the source code you can visit the <a target="_blank" href="https://github.com/sunxvming/my-blog">repo</a> and I'd be glad if you like and star it.</div>
</footer>
</div> <!--wrapper-->
</body>
</html>
